# communitynotes フォーク元オリジナルリポジトリからの変更点

## 開発環境

実行可能な開発環境は、`Dockerfile`, `requirements_modified.txt`を参照。

- フォーク元のオリジナルリポジトリに記載されているpython 3.7.9では、指定されたパッケージライブラリがインストールできないため、3.9.4に変更

- requirements.txt
    - `tensorflow==2.5.0`が記載されているが、tensorflowはソースコードで用いられていないため不要。
    - `numpy==1.19.2`は`torch==1.12.0`を入れると1.24.3にアップグレードされる。


## ソースコード

- constants.pyの341~345行目の`(current~`をコメントアウト  
（noteStatusHistory-00000.tsv に`current~`のカラムがないため）

- run_scoring.py 657行目を`useStableInitialization: bool = False`に変更。    
（`True`だと、userEnrollment-00000.tsvのmodelingGroupのカラムに13がないため、`mf_base_scorer`209行目でエラーが発生する。）  


- run_scoring.py 229行目でc.currentCoreStatusKeyではなく c.currentLabelKeyを引数にする。  
run_scoring.py 219行目でc.currentExpansionStatusKeyではなく c.currentLabelKeyを引数にする.  
（そのままだとnoteStatusHistory-00000.tsv にcurrentCoreStatus, currentExpansionStatusがないため、run_scoring.py 73行目でcurrentCoreStatusのkeyエラーが発生する。）   


## 実行方法

ratings-00000.tsvとratings-00001.tsvを結合したratings-total.tsvを入力する。
結合方法は`note_analysis.ipynb`に記載。

```
cd sourcecode

python main.py \
    --enrollment data/userEnrollment-00000.tsv \
    --notes data/notes-00000.tsv \
    --ratings data/ratings-total.tsv \
    --status data/noteStatusHistory-00000.tsv \
    --outdir data
```
